---
title: 'DS03 - Assessment: Probability'
author: "Victor Ivamoto"
date: "2019/10/27"
output:
  html_document: 
    toc: true
    toc_float: true
    code_folding: show    
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Section 1
## Section 1.1 Introduction to Discrete Probability
### Exercise 1. Probability of cyan - generalized
In the edX exercises for this section, we calculated some probabilities by hand. Now we'll calculate those probabilities using R.

One ball will be drawn at random from a box containing: 3 cyan balls, 5 magenta balls, and 7 yellow balls.

What is the probability that the ball will be cyan?

```{r}
cyan <- 3
magenta <- 5
yellow <- 7

# Assign a variable `p` as the probability of choosing a cyan ball from the box
p<-cyan/(cyan+magenta+yellow)

# Print the variable `p` to the console
p
```

### Exercise 2. Probability of not cyan - generalized
We defined the variable p as the probability of choosing a cyan ball from a box containing: 3 cyan balls, 5 magenta balls, and 7 yellow balls.

What is the probability that the ball you draw from the box will NOT be cyan?

```{r}
# `p` is defined as the probability of choosing a cyan ball from a box containing: 3 cyan balls, 5 magenta balls, and 7 yellow balls.
# Using variable `p`, calculate the probability of choosing any ball that is not cyan from the box
1-p
```

### Exercise 3. Sampling without replacement - generalized
Instead of taking just one draw, consider taking two draws. You take the second draw without returning the first draw to the box. We call this sampling without replacement.

What is the probability that the first draw is cyan and that the second draw is not cyan?

* Calculate the conditional probability p_2 of choosing a ball that is not cyan after one cyan ball has been removed from the box.
* Calculate the joint probability of both choosing a cyan ball on the first draw and a ball that is not cyan on the second draw using p_1 and p_2.
```{r}
cyan <- 3
magenta <- 5
yellow <- 7

# The variable `p_1` is the probability of choosing a cyan ball from the box on the first draw.
p_1 <- cyan / (cyan + magenta + yellow)

# Assign a variable `p_2` as the probability of not choosing a cyan ball on the second draw without replacement.
p_2 <- (magenta + yellow) / (cyan + magenta + yellow - 1)
# Calculate the probability that the first draw is cyan and the second draw is not cyan using `p_1` and `p_2`.
p_1 * p_2
```
### Exercise 4. Sampling with replacement - generalized
Now repeat the experiment, but this time, after taking the first draw and recording the color, return it back to the box and shake the box. We call this sampling with replacement.

What is the probability that the first draw is cyan and that the second draw is not cyan?

* Calculate the probability p_2 of choosing a ball that is not cyan on the second draw, with replacement.  
* Next, use p_1 and p_2 to calculate the probability of choosing a cyan ball on the first draw and a ball that is not cyan on the second draw (after replacing the first ball).  

```{r}
cyan <- 3
magenta <- 5
yellow <- 7

# The variable 'p_1' is the probability of choosing a cyan ball from the box on the first draw.
p_1 <- cyan / (cyan + magenta + yellow)

# Assign a variable 'p_2' as the probability of not choosing a cyan ball on the second draw with replacement.
p_2 <- (magenta + yellow) / (cyan + magenta + yellow)
# Calculate the probability that the first draw is cyan and the second draw is not cyan using `p_1` and `p_2`.
p_1 * p_2
```
## Section 1.2 Combinations and Permutations 
### Exercise 1. Independence
Imagine you draw two balls from a box containing colored balls. You either replace the first ball before you draw the second or you leave the first ball out of the box when you draw the second ball.

Under which situation are the two draws independent of one another?

Remember that two events A and B are independent if $Pr(A and B)=Pr(A)P(B)$

**Answer: You do replace the first ball before drawing the next.**

### Exercise 2. Sampling with replacement
Say youâ€™ve drawn 5 balls from the a box that has 3 cyan balls, 5 magenta balls, and 7 yellow balls, with replacement, and all have been yellow.

What is the probability that the next one is yellow?


* Assign the variable $p_yellow$ as the probability of choosing a yellow ball on the first draw.
* Using the variable $p_yellow$, calculate the probability of choosing a yellow ball on the sixth draw.

```{r}
cyan <- 3
magenta <- 5
yellow <- 7

# Assign the variable 'p_yellow' as the probability that a yellow ball is drawn from the box.
p_yellow <- yellow / (cyan + magenta + yellow)
# Using the variable 'p_yellow', calculate the probability of drawing a yellow ball on the sixth draw. Print this value to the console.
p_yellow
```
### Exercise 3. Rolling a die
If you roll a 6-sided die once, what is the probability of not seeing a 6? If you roll a 6-sided die six times, what is the probability of not seeing a 6 on any roll?


* Assign the variable $p\_no6$ as the probability of not seeing a 6 on a single roll.
* Then, calculate the probability of not seeing a 6 on six rolls using $p\_no6$.
```{r}
# Assign the variable 'p_no6' as the probability of not seeing a 6 on a single roll.
p_no6 <- 1 - 1/6

# Calculate the probability of not seeing a 6 on six rolls using `p_no6`. Print your result to the console: do not assign it to a variable.
p_no6 ^6
```
### Exercise 4. Probability the Celtics win a game
Two teams, say the Celtics and the Cavs, are playing a seven game series. The Cavs are a better team and have a 60% chance of winning each game.

What is the probability that the Celtics win at least one game? Remember that the Celtics must win one of the first four games, or the series will be over!

* Calculate the probability that the Cavs will win the first four games of the series.
* Calculate the probability that the Celtics win at least one game in the first four games of the series.

```{r}
# Assign the variable `p_cavs_win4` as the probability that the Cavs will win the first four games of the series.
p_cavs_win4 <- 0.6^4

# Using the variable `p_cavs_win4`, calculate the probability that the Celtics win at least one game in the first four games of the series.
1-p_cavs_win4
```
### Exercise 5. Monte Carlo simulation for Celtics winning a game
Create a Monte Carlo simulation to confirm your answer to the previous problem by estimating how frequently the Celtics win at least 1 of 4 games. Use $B <- 10000$ simulations.

The provided sample code simulates a single series of four random games, $simulated\_games$.

* Use the $replicate$ function for $B <- 10000$ simulations of a four game series. The results of $replicate$ should be stored to a variable named $celtic\_wins$.
* Within each simulation, replicate the sample code to simulate a four-game series named $simulated\_games$. Then, use the $any$ function to indicate whether the four-game series contains at least one win for the Celtics. Perform these operations in two separate steps.
* Use the $mean$ function on $celtic\_wins$ to find the proportion of simulations that contain at least one win for the Celtics out of four games.
```{R}
# This line of example code simulates four independent random games where the Celtics either lose or win. Copy this example code to use within the `replicate` function.
simulated_games <- sample(c("lose","win"), 4, replace = TRUE, prob = c(0.6, 0.4))

# The variable 'B' specifies the number of times we want the simulation to run. Let's run the Monte Carlo simulation 10,000 times.
B <- 10000

# Use the `set.seed` function to make sure your answer matches the expected result after random sampling.
set.seed(1, sample.kind = "Rounding")

# Create an object called `celtic_wins` that replicates two steps for B iterations: (1) generating a random four-game series `simulated_games` using the example code, then (2) determining whether the simulated series contains at least one win for the Celtics.
celtic_wins <- replicate(B,{
    simulated_games <- sample(c("lose","win"), 4, replace = TRUE, prob = c(0.6, 0.4))
    any(simulated_games=="win")
  }
  )

# Calculate the frequency out of B iterations that the Celtics won at least one game. Print your answer to the console.
mean(celtic_wins)
```

## Section 1.3: The Addition Rule and Monty Hall
### Exercise 1. The Cavs and the Warriors
Two teams, say the Cavs and the Warriors, are playing a seven game championship series. The first to win four games wins the series. The teams are equally good, so they each have a 50-50 chance of winning each game.

If the Cavs lose the first game, what is the probability that they win the series?

* Assign the number of remaining games to the variable $n$.
* Assign a variable $outcomes$ as a vector of possible outcomes in a single game, where 0 indicates a loss and 1 indicates a win for the Cavs.
Assign a variable $l$ to a list of all possible outcomes in all remaining games. Use the $rep$ function to create a list of n games, where each game consists of $list(outcomes)$.
* Use the $expand.grid$ function to create a data frame containing all the combinations of possible outcomes of the remaining games.
* Use the $rowSums$ function to identify which combinations of game outcomes result in the Cavs winning the number of games necessary to win the series.
* Use the $mean$ function to calculate the proportion of outcomes that result in the Cavs winning the series and print your answer to the console.
```{r}
# Assign a variable 'n' as the number of remaining games.
n <- 6

# Assign a variable `outcomes` as a vector of possible game outcomes, where 0 indicates a loss and 1 indicates a win for the Cavs.
#outcomes <- sample(c(0,1),n,replace=TRUE,prob=c(0.5,0.5))
outcomes <- c(0,1)

# Assign a variable `l` to a list of all possible outcomes in all remaining games. Use the `rep` function on `list(outcomes)` to create list of length `n`.
#l <- rep(sample(outcomes,1,replace=TRUE,prob=c(0.5,0.5)),times=n)
l <- rep(list(outcomes), times=n)

# Create a data frame named 'possibilities' that contains all combinations of possible outcomes for the remaining games.
possibilities <- expand.grid(l)

# Create a vector named 'results' that indicates whether each row in the data frame 'possibilities' contains enough wins for the Cavs to win the series.
results <- rowSums(possibilities)

# Calculate the proportion of 'results' in which the Cavs win the series. Print the outcome to the console.
mean(results>=4)
```
### Exercise 2. The Cavs and the Warriors - Monte Carlo
Confirm the results of the previous question with a Monte Carlo simulation to estimate the probability of the Cavs winning the series after losing the first game.

* Use the $replicate$ function to replicate the sample code for $B <- 10000$ simulations.
* Use the $sample$ function to simulate a series of 6 games with random, independent outcomes of either a loss for the Cavs (0) or a win for the Cavs (1) in that order. Use the default probabilities to sample.
* Use the $sum$ function to determine whether a simulated series contained at least 4 wins for the Cavs.
* Use the $mean$ function to find the proportion of simulations in which the Cavs win at least 4 of the remaining games. Print your answer to the console.
```{r}
# The variable `B` specifies the number of times we want the simulation to run. Let's run the Monte Carlo simulation 10,000 times.
B <- 10000

# Use the `set.seed` function to make sure your answer matches the expected result after random sampling.
set.seed(1, sample.kind = "Rounding")

# Create an object called `results` that replicates for `B` iterations a simulated series and determines whether that series contains at least four wins for the Cavs.
results <- replicate(B,{
    game <- sample(c(0,1),6,replace=TRUE)
    sum(game)
  }
)

# Calculate the frequency out of `B` iterations that the Cavs won at least four games in the remainder of the series. Print your answer to the console.
mean(results>=4)
```

### Exercise 3. A and B play a series - part 1
Two teams, A and B, are playing a seven series game series. Team A is better than team B and has a p>0.5 chance of winning each game.

* Use the function $sapply$ to compute the probability, call it Pr of winning for $p <- seq(0.5, 0.95, 0.025)$.
* Then plot the result $plot(p, Pr)$.
```{r}
# Let's assign the variable 'p' as the vector of probabilities that team A will win.
p <- seq(0.5, 0.95, 0.025)

# Given a value 'p', the probability of winning the series for the underdog team B can be computed with the following function based on a Monte Carlo simulation:
prob_win <- function(p){
  B <- 10000
  result <- replicate(B, {
    b_win <- sample(c(1,0), 7, replace = TRUE, prob = c(1-p, p))
    sum(b_win)>=4
    })
  mean(result)
}

# Apply the 'prob_win' function across the vector of probabilities that team A will win to determine the probability that team B will win. Call this object 'Pr'.
Pr=sapply(p,prob_win)

# Plot the probability 'p' on the x-axis and 'Pr' on the y-axis.
plot(p,Pr)
```
### Exercise 4. A and B play a series - part 2
Repeat the previous exercise, but now keep the probability that team $A$ wins fixed at $p <- 0.75$ and compute the probability for different series lengths. For example, wins in best of 1 game, 3 games, 5 games, and so on through a series that lasts 25 games.

* Use the $seq$ function to generate a list of odd numbers ranging from 1 to 25.
* Use the function $sapply$ to compute the probability, call it $Pr$, of winning during series of different lengths.
* Then plot the result $plot(N, Pr)$.
```{r}
# Given a value 'p', the probability of winning the series for the underdog team B can be computed with the following function based on a Monte Carlo simulation:
prob_win <- function(N, p=0.75){
      B <- 10000
      result <- replicate(B, {
        b_win <- sample(c(1,0), N, replace = TRUE, prob = c(1-p, p))
        sum(b_win)>=(N+1)/2
        })
      mean(result)
    }

# Assign the variable 'N' as the vector of series lengths. Use only odd numbers ranging from 1 to 25 games.
N <- seq(1,25,2)

# Apply the 'prob_win' function across the vector of series lengths to determine the probability that team B will win. Call this object `Pr`.
Pr <- sapply(N,prob_win)

# Plot the number of games in the series 'N' on the x-axis and 'Pr' on the y-axis.
plot(N,Pr)
```

## Section 1.4: Assessment: Discrete Probability
The following assessments allow you to practice the probability and coding skills you've learned in Section 1: Discrete Probability. You will likely find it useful to try out code to answer the problems using R on your own machine.

You will benefit from using the following libraries and options:

```{r}
library(gtools)
library(tidyverse)
options(digits = 3)    # report 3 significant digits
```
### Question 1: Olympic running
In the 200m dash finals in the Olympics, 8 runners compete for 3 medals (order matters). In the 2012 Olympics, 3 of the 8 runners were from Jamaica and the other 5 were from different countries. The three medals were all won by Jamaica (Usain Bolt, Yohan Blake, and Warren Weir).

Use the information above to help you answer the following four questions.

#### Question 1a
How many different ways can the 3 medals be distributed across 8 runners?
```{r}
library(gtools)
medals <- permutations(8,3)
nrow(medals)
```
#### Question 1b

How many different ways can the three medals be distributed among the 3 runners from Jamaica?
```{r}
jamaica <- permutations(3,3)
nrow(jamaica)
```
#### Question 1c

What is the probability that all 3 medals are won by Jamaica?
```{r}
nrow(jamaica)/nrow(medals)
```
#### Question 1d
Run a Monte Carlo simulation on this vector representing the countries of the 8 runners in this race:

```{r}
runners <- c("Jamaica", "Jamaica", "Jamaica", "USA", "Ecuador", "Netherlands", "France", "South Africa")
```
For each iteration of the Monte Carlo simulation, within a replicate loop, select 3 runners representing the 3 medalists and check whether they are all from Jamaica. Repeat this simulation 10,000 times. Set the seed to 1 before running the loop.

Calculate the probability that all the runners are from Jamaica.

```{r}
set.seed(1, sample.kind = "Rounding")
runners <- c("Jamaica", "Jamaica", "Jamaica", "USA", "Ecuador", "Netherlands", "France", "South Africa")
B <- 10000
all_jamaica <- replicate(B, {
  results <- sample(runners, 3)
  all(results == "Jamaica")
})
mean(all_jamaica)
```

### Question 2: Restaurant management
Use the information below to answer the following five questions.

A restaurant manager wants to advertise that his lunch special offers enough choices to eat different meals every day of the year. He doesn't think his current special actually allows that number of choices, but wants to change his special if needed to allow at least 365 choices.

A meal at the restaurant includes 1 entree, 2 sides, and 1 drink. He currently offers a choice of 1 entree from a list of 6 options, a choice of 2 different sides from a list of 6 options, and a choice of 1 drink from a list of 2 options.

#### Question 2a

How many meal combinations are possible with the current menu?
```{r}
6 * nrow(combinations(6,2)) * 2
```
#### Question 2b
The manager has one additional drink he could add to the special.

How many combinations are possible if he expands his original special to 3 drink options?
```{r}
6 * nrow(combinations(6,2)) * 3
```
#### Question 2c
The manager decides to add the third drink but needs to expand the number of options. The manager would prefer not to change his menu further and wants to know if he can meet his goal by letting customers choose more sides.

How many meal combinations are there if customers can choose from 6 entrees, 3 drinks, and select 3 sides from the current 6 options?
```{r}
6 * nrow(combinations(6,3)) * 3
```
#### Question 2d
The manager is concerned that customers may not want 3 sides with their meal. He is willing to increase the number of entree choices instead, but if he adds too many expensive options it could eat into profits. He wants to know how many entree choices he would have to offer in order to meet his goal.

- Write a function that takes a number of entree choices and returns the number of meal combinations possible given that number of entree options, 3 drink choices, and a selection of 2 sides from 6 options.

- Use $sapply$ to apply the function to entree option counts ranging from 1 to 12.

What is the minimum number of entree options required in order to generate more than 365 combinations?
```{r}
library(tidyverse)

entree_choices <- function(x){
  x * nrow(combinations(6,2)) * 3
}

combos <- sapply(1:12, entree_choices)

data.frame(entrees = 1:12, combos = combos) %>%
  filter(combos > 365) %>%
  min(.$entrees)
```
#### Question 2e

The manager isn't sure he can afford to put that many entree choices on the lunch menu and thinks it would be cheaper for him to expand the number of sides. He wants to know how many sides he would have to offer to meet his goal of at least 365 combinations.

- Write a function that takes a number of side choices and returns the number of meal combinations possible given 6 entree choices, 3 drink choices, and a selection of 2 sides from the specified number of side choices.

- Use $sapply$ to apply the function to side counts ranging from 2 to 12.

What is the minimum number of side options required in order to generate more than 365 combinations?
```{r}
side_choices <- function(x){
  6 * nrow(combinations(x, 2)) * 3
}

combos <- sapply(2:12, side_choices)

data.frame(sides = 2:12, combos = combos) %>%
  filter(combos > 365) %>%
  min(.$sides)

```

### Questions 3 and 4: Esophageal cancer and alcohol/tobacco use, part 1
Case-control studies help determine whether certain exposures are associated with outcomes such as developing cancer. The built-in dataset esoph contains data from a case-control study in France comparing people with esophageal cancer (cases, counted in ncases) to people without esophageal cancer (controls, counted in ncontrols) that are carefully matched on a variety of demographic and medical characteristics. The study compares alcohol intake in grams per day (alcgp) and tobacco intake in grams per day (tobgp) across cases and controls grouped by age range (agegp).

The dataset is available in base R and can be called with the variable name esoph:

```{r}
head(esoph)
```

You will be using this dataset to answer the following four multi-part questions (Questions 3-6).

You may wish to use the tidyverse package:

```{r}
library(tidyverse)
```
The following three parts have you explore some basic characteristics of the dataset.

Each row contains one group of the experiment. Each group has a different combination of age, alcohol consumption, and tobacco consumption. The number of cancer cases and number of controls (individuals without cancer) are reported for each group.

#### Question 3a
How many groups are in the study?
```{r}
nrow(esoph)
```
#### Question 3b
How many cases are there?
Save this value as $all_cases$ for later problems.
```{r}
all_cases <- sum(esoph$ncases)
all_cases
```
#### Question 3c
How many controls are there?
Save this value as $all_controls$ for later problems.
```{r}
all_controls <- sum(esoph$ncontrols)
all_controls
```
The following four parts ask you to explore some probabilities within this dataset related to alcohol and tobacco consumption.


#### Question 4a
What is the probability that a subject in the highest alcohol consumption group is a cancer case?
```{r}
esoph %>%
  filter(alcgp == "120+") %>%
  summarize(ncases = sum(ncases), ncontrols = sum(ncontrols)) %>%
  mutate(p_case = ncases / (ncases + ncontrols)) %>%
  pull(p_case)

```
#### Question 4b

What is the probability that a subject in the lowest alcohol consumption group is a cancer case?
```{r}
esoph %>%
  filter(alcgp == "0-39g/day") %>%
  summarize(ncases = sum(ncases), ncontrols = sum(ncontrols)) %>%
  mutate(p_case = ncases / (ncases + ncontrols)) %>%
  pull(p_case)
```
#### Question 4c
Given that a person is a case, what is the probability that they smoke 10g or more a day?
```{r}
tob_cases <- esoph %>%
  filter(tobgp != "0-9g/day") %>%
  pull(ncases) %>%
  sum()

tob_cases/all_cases
```
#### Question 4d
Given that a person is a control, what is the probability that they smoke 10g or more a day?
```{r}
tob_controls <- esoph %>%
  filter(tobgp != "0-9g/day") %>%
  pull(ncontrols) %>%
  sum()

tob_controls/all_controls
```

### Questions 5 and 6: Esophageal cancer and alcohol/tobacco use, part 2

The following four parts look at probabilities related to alcohol and tobacco consumption among the cases.

#### Question 5a
For cases, what is the probability of being in the highest alcohol group?
```{r}
high_alc_cases <- esoph %>%
  filter(alcgp == "120+") %>%
  pull(ncases) %>%
  sum()

p_case_high_alc <- high_alc_cases/all_cases
p_case_high_alc
```
#### Question 5b
For cases, what is the probability of being in the highest tobacco group?
```{r}
high_tob_cases <- esoph %>%
  filter(tobgp == "30+") %>%
  pull(ncases) %>%
  sum()

p_case_high_tob <- high_tob_cases/all_cases
p_case_high_tob
```
#### Question 5c

For cases, what is the probability of being in the highest alcohol group and the highest tobacco group?
```{r}
high_alc_tob_cases <- esoph %>%
  filter(alcgp == "120+" & tobgp == "30+") %>%
  pull(ncases) %>%
  sum()

p_case_high_alc_tob <- high_alc_tob_cases/all_cases
p_case_high_alc_tob
```
#### Question 5d
For cases, what is the probability of being in the highest alcohol group or the highest tobacco group?
```{r}
p_case_either_highest <- p_case_high_alc + p_case_high_tob - p_case_high_alc_tob
p_case_either_highest
```
The following six parts look at probabilities related to alcohol and tobacco consumption among the controls and also compare the cases and the controls.

#### Question 6a
For controls, what is the probability of being in the highest alcohol group?
```{r}
high_alc_controls <- esoph %>%
  filter(alcgp == "120+") %>%
  pull(ncontrols) %>%
  sum()

p_control_high_alc <- high_alc_controls/all_controls
p_control_high_alc
```
#### Question 6b
How many times more likely are cases than controls to be in the highest alcohol group?
```{r}
p_case_high_alc/p_control_high_alc
```
#### Question 6c
For controls, what is the probability of being in the highest tobacco group?
```{r}
high_tob_controls <- esoph %>%
  filter(tobgp == "30+") %>%
  pull(ncontrols) %>%
  sum()

p_control_high_tob <- high_tob_controls/all_controls
p_control_high_tob
```
#### Question 6d
For controls, what is the probability of being in the highest alcohol group and the highest tobacco group?
```{r}
high_alc_tob_controls <- esoph %>%
  filter(alcgp == "120+" & tobgp == "30+") %>%
  pull(ncontrols) %>%
  sum()

p_control_high_alc_tob <- high_alc_tob_controls/all_controls
p_control_high_alc_tob
```
#### Question 6e

For controls, what is the probability of being in the highest alcohol group or the highest tobacco group?
```{r}
p_control_either_highest <- p_control_high_alc + p_control_high_tob - p_control_high_alc_tob
p_control_either_highest
```
#### Question 6f
How many times more likely are cases than controls to be in the highest alcohol group or the highest tobacco group?
```{r}
p_case_either_highest/p_control_either_highest
```

# Section 2
## Section 2.1: Continuous Probability

### Exercise 1. Distribution of female heights - 1
Assume the distribution of female heights is approximated by a normal distribution with a mean of 64 inches and a standard deviation of 3 inches. If we pick a female at random, what is the probability that she is 5 feet or shorter?

* Use $pnorm$ to define the probability that a height will take a value less than 5 feet given the stated distribution.
```{r}
# Assign a variable 'female_avg' as the average female height.
female_avg <- 64

# Assign a variable 'female_sd' as the standard deviation for female heights.
female_sd <- 3

# Using variables 'female_avg' and 'female_sd', calculate the probability that a randomly selected female is shorter than 5 feet. Print this value to the console.
pnorm(5*12,female_avg, female_sd)
```
### Exercise 2. Distribution of female heights - 2
Assume the distribution of female heights is approximated by a normal distribution with a mean of 64 inches and a standard deviation of 3 inches. If we pick a female at random, what is the probability that she is 6 feet or taller?

* Use $pnorm$ to define the probability that a height will take a value of 6 feet or taller.
```{r}
# Assign a variable 'female_avg' as the average female height.
female_avg <- 64

# Assign a variable 'female_sd' as the standard deviation for female heights.
female_sd <- 3

# Using variables 'female_avg' and 'female_sd', calculate the probability that a randomly selected female is 6 feet or taller. Print this value to the console.
1 - pnorm(6*12, female_avg, female_sd)
```
### Exercise 3. Distribution of female heights - 3
Assume the distribution of female heights is approximated by a normal distribution with a mean of 64 inches and a standard deviation of 3 inches. If we pick a female at random, what is the probability that she is between 61 and 67 inches?

* Use $pnorm$ to define the probability that a randomly chosen woman will be shorter than 67 inches.
* Subtract the probability that a randomly chosen will be shorter than 61 inches.
```{r}
# Assign a variable 'female_avg' as the average female height.
female_avg <- 64

# Assign a variable 'female_sd' as the standard deviation for female heights.
female_sd <- 3

# Using variables 'female_avg' and 'female_sd', calculate the probability that a randomly selected female is between the desired height range. Print this value to the console.
pnorm(67,female_avg, female_sd) - pnorm(61,female_avg, female_sd) 
```
### Exercise 4. Distribution of female heights - 4
Repeat the previous exercise, but convert everything to centimeters. That is, multiply every height, including the standard deviation, by 2.54. What is the answer now?

* Convert the average height and standard deviation to centimeters by multiplying each value by 2.54.
* Repeat the previous calculation using $pnorm$ to define the probability that a randomly chosen woman will have a height between 61 and 67 inches, converted to centimeters by multiplying each value by 2.54.
```{r}
# Assign a variable 'female_avg' as the average female height. Convert this value to centimeters.
female_avg <- 64*2.54

# Assign a variable 'female_sd' as the standard deviation for female heights. Convert this value to centimeters.
female_sd <- 3*2.54

# Using variables 'female_avg' and 'female_sd', calculate the probability that a randomly selected female is between the desired height range. Print this value to the console.
pnorm(67*2.54,female_avg, female_sd) - pnorm(61*2.54,female_avg, female_sd) 
```
### Exercise 5. Probability of 1 SD from average
Compute the probability that the height of a randomly chosen female is within 1 SD from the average height.

* Calculate the values for heights one standard deviation taller and shorter than the average.
* Calculate the probability that a randomly chosen woman will be within 1 SD from the average height.
```{r}
# Assign a variable 'female_avg' as the average female height.
female_avg <- 64

# Assign a variable 'female_sd' as the standard deviation for female heights.
female_sd <- 3

# To a variable named 'taller', assign the value of a height that is one SD taller than average.
taller <- female_avg + female_sd

# To a variable named 'shorter', assign the value of a height that is one SD shorter than average.
shorter <- female_avg - female_sd

# Calculate the probability that a randomly selected female is between the desired height range. Print this value to the console.
pnorm(taller, female_avg, female_sd) - pnorm(shorter, female_avg, female_sd)
```
### Exercise 6. Distribution of male heights
Imagine the distribution of male adults is approximately normal with an average of 69 inches and a standard deviation of 3 inches. How tall is a male in the 99th percentile?

* Determine the height of a man in the 99th percentile, given an average height of 69 inches and a standard deviation of 3 inches.
```{r}
# Assign a variable 'male_avg' as the average male height.
male_avg <- 69

# Assign a variable 'male_sd' as the standard deviation for male heights.
male_sd <- 3

# Determine the height of a man in the 99th percentile of the distribution.
qnorm(0.99,male_avg, male_sd)
```
### Exercise 7. Distribution of IQ scores
The distribution of IQ scores is approximately normally distributed. The average is 100 and the standard deviation is 15. Suppose you want to know the distribution of the person with the highest IQ in your school district, where 10,000 people are born each year.

Generate 10,000 IQ scores 1,000 times using a Monte Carlo simulation. Make a histogram of the highest IQ scores.

* Use the function $rnorm$ to generate a random distribution of 10,000 values with a given average and standard deviation.
* Use the function $max$ to return the largest value from a supplied vector.
* Repeat the previous steps a total of 1,000 times. Store the vector of the top 1,000 IQ scores as $highestIQ$.
* Plot the histogram of values using the function $hist$.
```{r}
# The variable `B` specifies the number of times we want the simulation to run.
B <- 1000

# Use the `set.seed` function to make sure your answer matches the expected result after random number generation.
set.seed(1, sample.kind = "Rounding")

# Create an object called `highestIQ` that contains the highest IQ score from each random distribution of 10,000 people.
highestIQ <- replicate(B, { 
  res <- rnorm(10000, 100, 15)
  max(res)
})

# Make a histogram of the highest IQ scores.
hist(highestIQ)
```
## Section 2.2 Continuous Probability
### Questions 1 and 2: ACT scores, part 1
The ACT is a standardized college admissions test used in the United States. The four multi-part questions in this assessment all involve simulating some ACT test scores and answering probability questions about them.

For the three year period 2016-2018, [ACT standardized test scores](http://www.act.org/content/act/en/products-and-services/the-act/scores/national-ranks.html) were approximately normally distributed with a mean of 20.9 and standard deviation of 5.7. (Real ACT scores are integers between 1 and 36, but we will ignore this detail and use continuous values instead.)

First we'll simulate an ACT test score dataset and answer some questions about it.

Set the seed to 16, then use rnorm to generate a normal distribution of 10000 tests with a mean of 20.9 and standard deviation of 5.7. Save these values as $act\_scores$. You'll be using this dataset throughout these four multi-part questions.

#### Question 1a
What is the mean of $act\_scores$?
```{r}
set.seed(16, sample.kind = "Rounding")
act_scores <- rnorm(10000, 20.9, 5.7)
mean(act_scores)
```
#### Question 1b
What is the standard deviation of $act_scores$?
```{r}
sd(act_scores)

```
#### Question 1c
A perfect score is 36 or greater (the maximum reported score is 36).

In $act\_scores$, how many perfect scores are there out of 10,000 simulated tests?
 ```{r}
 sum(act_scores >= 36)
```
#### Question 1d
In $act\_scores$, what is the probability of an ACT score greater than 30?

```{r}
mean(act_scores > 30)
```
#### Question 1e
In $act\_scores$, what is the probability of an ACT score less than or equal to 10?
```{r}
mean(act_scores <= 10)
```
### Question 2
Set $x$ equal to the sequence of integers 1 to 36. Use $dnorm$ to determine the value of the probability density function over $x$ given a mean of 20.9 and standard deviation of 5.7; save the result as $f\_x$. Plot $x$ against $f\_x$.

Which of the following plots is correct?

```{r}
library(dplyr)
library(ggplot2)
x <- 1:36
f_x <- dnorm(x, 20.9, 5.7)
data.frame(x, f_x) %>%
  ggplot(aes(x, f_x)) +
  geom_line()
```

### Questions 3 and 4: ACT scores, part 2
In this 3-part question, you will convert raw ACT scores to Z-scores and answer some questions about them.

Convert **act_scores** to Z-scores. Recall from Data Visualization (the second course in this series) that to standardize values (convert values into Z-scores, that is, values distributed with a mean of 0 and standard deviation of 1), you must subtract the mean and then divide by the standard deviation. Use the mean and standard deviation of $act\_scores$, not the original values used to generate random test scores.
#### Question 3a
What is the probability of a Z-score greater than 2 (2 standard deviations above the mean)?
```{r}
z_scores <- (act_scores - mean(act_scores))/sd(act_scores)
mean(z_scores > 2)
```
#### Question 3b
What ACT score value corresponds to 2 standard deviations above the mean (Z = 2)?
```{r}
2*sd(act_scores) + mean(act_scores)
```
#### Question 3c
A Z-score of 2 corresponds roughly to the 97.5th percentile.

Use $qnorm$ to determine the 97.5th percentile of normally distributed data with the mean and standard deviation observed in $act\_scores$.

What is the 97.5th percentile of $act\_scores$?
```{r}
qnorm(.975, mean(act_scores), sd(act_scores))
```
In this 4-part question, you will write a function to create a CDF for ACT scores.

Write a function that takes a value and produces the probability of an ACT score less than or equal to that value (the CDF). Apply this function to the range 1 to 36.

#### Question 4a
What is the minimum integer score such that the probability of that score or lower is at least .95?
```{r}
cdf <- sapply(1:36, function (x){
  mean(act_scores <= x)
})
min(which(cdf >= .95))
```
#### Question 4b
Use $qnorm$ to determine the expected 95th percentile, the value for which the probability of receiving that score or lower is 0.95, given a mean score of 20.9 and standard deviation of 5.7.

What is the expected 95th percentile of ACT scores?
```{r}
qnorm(.95, 20.9, 5.7)
```
#### Question 4c
As discussed in the Data Visualization course, we can use $quantile$ to determine sample quantiles from the data.

Make a vector containing the quantiles for $p <- seq(0.01, 0.99, 0.01)$, the 1st through 99th percentiles of the $act\_scores$ data. Save these as $sample\_quantiles$.

In what percentile is a score of 26?
Note that a score between the 98th and 99th percentile should be considered the 98th percentile, for example, and that quantile numbers are used as names for the vector $sample\_quantiles$.
```{r}
p <- seq(0.01, 0.99, 0.01)
sample_quantiles <- quantile(act_scores, p)
names(sample_quantiles[max(which(sample_quantiles < 26))])
```
#### Question 4d
Make a corresponding set of theoretical quantiles using $qnorm$ over the interval $p <- seq(0.01, 0.99, 0.01)$ with mean 20.9 and standard deviation 5.7. Save these as $theoretical\_quantiles$. Make a QQ-plot graphing $sample\_quantiles$ on the y-axis versus $theoretical\_quantiles$ on the x-axis.

Which of the following graphs is correct?
```{r}
p <- seq(0.01, 0.99, 0.01)
sample_quantiles <- quantile(act_scores, p)
theoretical_quantiles <- qnorm(p, 20.9, 5.7)
qplot(theoretical_quantiles, sample_quantiles) + geom_abline()
```

# Section 3
## Section 3.1:  Random Variables and Sampling Models
### Exercise 1. American Roulette probabilities
An American roulette wheel has 18 red, 18 black, and 2 green pockets. Each red and black pocket is associated with a number from 1 to 36. The two remaining green slots feature "0" and "00". Players place bets on which pocket they think a ball will land in after the wheel is spun. Players can bet on a specific number (0, 00, 1-36) or color (red, black, or green).

What are the chances that the ball lands in a green pocket?

* Define a variable $p\_green$ as the probability of the ball landing in a green pocket.
* Print the value of $p\_green$.

```{r}
# The variables `green`, `black`, and `red` contain the number of pockets for each color
green <- 2
black <- 18
red <- 18

# Assign a variable `p_green` as the probability of the ball landing in a green pocket
p_green <- green/(green+black+red)

# Print the variable `p_green` to the console
p_green
```
### Exercise 2. American Roulette payout
In American roulette, the payout for winning on green is \$17. This means that if you bet \$1 and it lands on green, you get \$17 as a prize.

Create a model to predict your winnings from betting on green one time.

* Use the $sample$ function return a random value from a specified range of values.
* Use the $prob =$ argument in the $sample$ function to specify a vector of probabilities for returning each of the values contained in the vector of values being sampled.
* Take a single sample (n = 1).
```{r}
# Use the `set.seed` function to make sure your answer matches the expected result after random sampling.
set.seed(1, sample.kind = "Rounding")

# The variables 'green', 'black', and 'red' contain the number of pockets for each color
green <- 2
black <- 18
red <- 18

# Assign a variable `p_green` as the probability of the ball landing in a green pocket
p_green <- green / (green+black+red)

# Assign a variable `p_not_green` as the probability of the ball not landing in a green pocket
p_not_green <- 1 - p_green

# Create a model to predict the random variable `X`, your winnings from betting on green. Sample one time.
X <- sample(c(17,-1),1,replace=TRUE,prob=c(p_green,p_not_green))

# Print the value of `X` to the console
X
```
### Exercise 3. American Roulette expected value
In American roulette, the payout for winning on green is \$17. This means that if you bet \$1 and it lands on green, you get \$17 as a prize.In the previous exercise, you created a model to predict your winnings from betting on green.

Now, compute the expected value of $X$, the random variable you generated previously.

- Using the chances of winning \$17 ($p\_green$) and the chances of losing \$1 ($p\_not\_green$), calculate the expected outcome of a bet that the ball will land in a green pocket.
```{r}
# The variables 'green', 'black', and 'red' contain the number of pockets for each color
green <- 2
black <- 18
red <- 18

# Assign a variable `p_green` as the probability of the ball landing in a green pocket
p_green <- green / (green+black+red)

# Assign a variable `p_not_green` as the probability of the ball not landing in a green pocket
p_not_green <- 1-p_green

# Calculate the expected outcome if you win $17 if the ball lands on green and you lose $1 if the ball doesn't land on green
17 * p_green + -1 * p_not_green
```
### Exercise 4. American Roulette standard error
The standard error of a random variable $X$ tells us the difference between a random variable and its expected value. You calculated a random variable $X$ in exercise 2 and the expected value of that random variable in exercise 3.

Now, compute the standard error of that random variable, which represents a single outcome after one spin of the roulette wheel.

- Compute the standard error of the random variable you generated in exercise 2, or the outcome of any one spin of the roulette wheel.
- Recall that the payout for winning on green is \$17 for a \$1 bet.
```{r}
# The variables 'green', 'black', and 'red' contain the number of pockets for each color
green <- 2
black <- 18
red <- 18

# Assign a variable `p_green` as the probability of the ball landing in a green pocket
p_green <- green / (green+black+red)

# Assign a variable `p_not_green` as the probability of the ball not landing in a green pocket
p_not_green <- 1-p_green

# Compute the standard error of the random variable
abs(17 - -1)* sqrt(p_green * p_not_green)
```
### Exercise 5. American Roulette sum of winnings
You modeled the outcome of a single spin of the roulette wheel, $X$, in exercise 2.

Now create a random variable $S$ that sums your winnings after betting on green 1,000 times.

- Use $set.seed$ to make sure the result of your random operation matches the expected answer for this problem.
- Specify the number of times you want to sample from the possible outcomes.
- Use the $sample$ function to return a random value from a vector of possible values.
```{r}
# The variables 'green', 'black', and 'red' contain the number of pockets for each color
green <- 2
black <- 18
red <- 18

# Assign a variable `p_green` as the probability of the ball landing in a green pocket
p_green <- green / (green+black+red)

# Assign a variable `p_not_green` as the probability of the ball not landing in a green pocket
p_not_green <- 1-p_green

# Use the `set.seed` function to make sure your answer matches the expected result after random sampling
set.seed(1, sample.kind = "Rounding")

# Define the number of bets using the variable 'n'
n <- 1000

# Create a vector called 'X' that contains the outcomes of 1000 samples
X <- sample(c(17,-1),n,replace=TRUE,prob=c(p_green,p_not_green))

# Assign the sum of all 1000 outcomes to the variable 'S'
S <- sum(X)

# Print the value of 'S' to the console
S
```
### Exercise 6. American Roulette winnings expected value
In the previous exercise, you generated a vector of random outcomes, $S$, after betting on green 1,000 times.

What is the expected value of $S$?

- Using the chances of winning \$17 ($p\_green$) and the chances of losing \$1 ($p\_not\_green$), calculate the expected outcome of a bet that the ball will land in a green pocket over 1,000 bets.

```{r}
# The variables 'green', 'black', and 'red' contain the number of pockets for each color
green <- 2
black <- 18
red <- 18

# Assign a variable `p_green` as the probability of the ball landing in a green pocket
p_green <- green / (green+black+red)

# Assign a variable `p_not_green` as the probability of the ball not landing in a green pocket
p_not_green <- 1-p_green

# Define the number of bets using the variable 'n'
n <- 1000

# Calculate the expected outcome of 1,000 spins if you win $17 when the ball lands on green and you lose $1 when the ball doesn't land on green
n * 17 * p_green + n * (-1) * p_not_green
```
### Exercise 7. American Roulette winnings expected value
You generated the expected value of $S$, the outcomes of 1,000 bets that the ball lands in the green pocket, in the previous exercise.

What is the standard error of $S$?

- Compute the standard error of the random variable you generated in exercise 5, or the outcomes of 1,000 spins of the roulette wheel.
```{r}
# The variables 'green', 'black', and 'red' contain the number of pockets for each color
green <- 2
black <- 18
red <- 18

# Assign a variable `p_green` as the probability of the ball landing in a green pocket
p_green <- green / (green+black+red)

# Assign a variable `p_not_green` as the probability of the ball not landing in a green pocket
p_not_green <- 1-p_green

# Define the number of bets using the variable 'n'
n <- 1000

# Compute the standard error of the sum of 1,000 outcomes
sqrt(n) * abs(17 - -1) * sqrt(p_green * p_not_green)
```
## Section 3.2 The Central Limit Theorem Continued 
### Exercise 1. American Roulette probability of winning money
The exercises in the previous chapter explored winnings in American roulette. In this chapter of exercises, we will continue with the roulette example and add in the Central Limit Theorem.

In the previous chapter of exercises, you created a random variable S that is the sum of your winnings after betting on green a number of times in American Roulette.

What is the probability that you end up winning money if you bet on green 100 times?

- Execute the sample code to determine the expected value $avg$ and standard error $se$ as you have done in previous exercises.
- Use the $pnorm$ function to determine the probability of winning money.
```{r}
# Assign a variable `p_green` as the probability of the ball landing in a green pocket
p_green <- 2 / 38

# Assign a variable `p_not_green` as the probability of the ball not landing in a green pocket
p_not_green <- 1-p_green

# Define the number of bets using the variable 'n'
n <- 100

# Calculate 'avg', the expected outcome of 100 spins if you win $17 when the ball lands on green and you lose $1 when the ball doesn't land on green
avg <- n * (17*p_green + -1*p_not_green)

# Compute 'se', the standard error of the sum of 100 outcomes
se <- sqrt(n) * (17 - -1)*sqrt(p_green*p_not_green)

# Using the expected value 'avg' and standard error 'se', compute the probability that you win money betting on green 100 times.
1-pnorm(0,avg,se)
```
### Exercise 2. American Roulette Monte Carlo simulation
Create a Monte Carlo simulation that generates 10,000 outcomes of $S$, the sum of 100 bets.

Compute the average and standard deviation of the resulting list and compare them to the expected value (-5.263158) and standard error (40.19344) for S that you calculated previously.

- Use the $replicate$ function to replicate the sample code for $B <- 10000$ simulations.
- Within $replicate$, use the $sample$ function to simulate $n <- 100$ outcomes of either a win (17) or a loss (-1) for the bet. Use the order $c(17, -1)$ and corresponding probabilities. Then, use the $sum$ function to add up the winnings over all iterations of the model. Make sure to include $sum$ or DataCamp may crash with a "Session Expired" error.
- Use the $mean$ function to compute the average winnings.
- Use the $sd$ function to compute the standard deviation of the winnings.
```{r}
# Assign a variable `p_green` as the probability of the ball landing in a green pocket
p_green <- 2 / 38

# Assign a variable `p_not_green` as the probability of the ball not landing in a green pocket
p_not_green <- 1-p_green

# Define the number of bets using the variable 'n'
n <- 100

# The variable `B` specifies the number of times we want the simulation to run. Let's run the Monte Carlo simulation 10,000 times.
B <- 10000

# Use the `set.seed` function to make sure your answer matches the expected result after random sampling.
set.seed(1, sample.kind = "Rounding")

# Create an object called `S` that replicates the sample code for `B` iterations and sums the outcomes.
S <- replicate(B, {
      res <- sample(c(17,-1),n,replace=TRUE,prob=c(p_green,p_not_green))
      sum(res)
})

# Compute the average value for 'S'
mean(S)

# Calculate the standard deviation of 'S'
sd(S)
```
### Exercise 3. American Roulette Monte Carlo vs CLT
In this chapter, you calculated the probability of winning money in American roulette using the CLT.

Now, calculate the probability of winning money from the Monte Carlo simulation. The Monte Carlo simulation from the previous exercise has already been pre-run for you, resulting in the variable S that contains a list of 10,000 simulated outcomes.

- Use the $mean$ function to calculate the probability of winning money from the Monte Carlo simulation, $S$.
```{r}
# Calculate the proportion of outcomes in the vector `S` that exceed $0
mean(S>=0)
```
### Exercise 4. American Roulette Monte Carlo vs CLT comparison
The Monte Carlo result and the CLT approximation for the probability of losing money after 100 bets are close, but not that close. What could account for this?

**Answer: The CLT does not work as well when the probability of success is small.**

### Exercise 5. American Roulette average winnings per bet
Now create a random variable $Y$ that contains your average winnings per bet after betting on green 10,000 times.

- Run a single Monte Carlo simulation of 10,000 bets using the following steps. (You do not need to $replicate$ the sample code.)
- Specify $n$ as the number of times you want to sample from the possible outcomes.
- Use the $sample$ function to return $n$ values from a vector of possible values: winning \$17 or losing \$1. Be sure to assign a probability to each outcome and indicate that you are sampling with replacement.
- Calculate the average result per bet placed using the $mean$ function.
```{r}
# Use the `set.seed` function to make sure your answer matches the expected result after random sampling.
set.seed(1, sample.kind = "Rounding")

# Define the number of bets using the variable 'n'
n <- 10000

# Assign a variable `p_green` as the probability of the ball landing in a green pocket
p_green <- 2 / 38

# Assign a variable `p_not_green` as the probability of the ball not landing in a green pocket
p_not_green <- 1 - p_green

# Create a vector called `X` that contains the outcomes of `n` bets
X <- sample(c(17,-1),n,replace=TRUE,prob=c(p_green,p_not_green))

# Define a variable `Y` that contains the mean outcome per bet. Print this mean to the console.
(Y <- mean(X))
```
### Exercise 6. American Roulette per bet expected value
What is the expected value of $Y$, the average outcome per bet after betting on green 10,000 times?

- Using the chances of winning \$17 ($p\_green$) and the chances of losing \$1 ($p\_not\_green$), calculate the expected outcome of a bet that the ball will land in a green pocket.
- Use the expected value formula rather than a Monte Carlo simulation.
- Print this value to the console (do not assign it to a variable).
```{r}
# Assign a variable `p_green` as the probability of the ball landing in a green pocket
p_green <- 2 / 38

# Assign a variable `p_not_green` as the probability of the ball not landing in a green pocket
p_not_green <- 1 - p_green

# Calculate the expected outcome of `Y`, the mean outcome per bet in 10,000 bets
17*p_green - p_not_green
```
### Exercise 7. American Roulette per bet standard error
What is the standard error of $Y$, the average result of 10,000 spins?

- Compute the standard error of $Y$, the average result of 10,000 independent spins.
```{r}
# Define the number of bets using the variable 'n'
n <- 10000

# Assign a variable `p_green` as the probability of the ball landing in a green pocket
p_green <- 2 / 38

# Assign a variable `p_not_green` as the probability of the ball not landing in a green pocket
p_not_green <- 1 - p_green

# Compute the standard error of 'Y', the mean outcome per bet from 10,000 bets.
sqrt(n)*abs(17- -1)*sqrt(p_green*p_not_green)/n
```
### Exercise 8. American Roulette winnings per game are positive
What is the probability that your winnings are positive after betting on green 10,000 times?

- Execute the code that we wrote in previous exercises to determine the average and standard error.
- Use the $pnorm$ function to determine the probability of winning more than $0.
```{r}
# We defined the average using the following code
avg <- 17*p_green + -1*p_not_green

# We defined standard error using this equation
se <- 1/sqrt(n) * (17 - -1)*sqrt(p_green*p_not_green)

# Given this average and standard error, determine the probability of winning more than $0. Print the result to the console.
1- pnorm(0,avg,se)
```
### Exercise 9. American Roulette Monte Carlo again
Create a Monte Carlo simulation that generates 10,000 outcomes of $S$, the average outcome from 10,000 bets on green.

Compute the average and standard deviation of the resulting list to confirm the results from previous exercises using the Central Limit Theorem.

- Use the $replicate$ function to model 10,000 iterations of a series of 10,000 bets.
- Each iteration inside $replicate$ should simulate 10,000 bets and determine the average outcome of those 10,000 bets. *If you forget to take the mean, DataCamp will crash with a "Session Expired" error*.
- Find the average of the 10,000 average outcomes. Print this value to the console.
- Compute the standard deviation of the 10,000 simulations. Print this value to the console.
```{r}
## Make sure you fully follow instructions, including printing values to the console and correctly running the `replicate` loop. If not, you may encounter "Session Expired" errors.

# The variable `n` specifies the number of independent bets on green
n <- 10000

# The variable `B` specifies the number of times we want the simulation to run
B <- 10000

# Use the `set.seed` function to make sure your answer matches the expected result after random number generation
set.seed(1, sample.kind = "Rounding")

# Generate a vector `S` that contains the the average outcomes of 10,000 bets modeled 10,000 times
S <- replicate(B,{
  res <- sample(c(17,-1),n,replace=TRUE,prob=c(2/38,36/38))
  mean(res)
})

# Compute the average of `S`
mean(S)

# Compute the standard deviation of `S`
sd(S)
```
### Exercise 10. American Roulette comparison
In a previous exercise, you found the probability of winning more than \$0 after betting on green 10,000 times using the Central Limit Theorem. Then, you used a Monte Carlo simulation to model the average result of betting on green 10,000 times over 10,000 simulated series of bets.

What is the probability of winning more than \$0 as estimated by your Monte Carlo simulation? The code to generate the vector $S$ that contains the the average outcomes of 10,000 bets modeled 10,000 times has already been run for you.

- Calculate the probability of winning more than \$0 in the Monte Carlo simulation from the previous exercise using the $mean$ function.
- You do not need to run another simulation: the results of the simulation are in your workspace as the vector $S$.
```{r}
# Compute the proportion of outcomes in the vector 'S' where you won more than $0
mean(S>=0)
```
### Exercise 11. American Roulette comparison analysis
The Monte Carlo result and the CLT approximation are now much closer than when we calculated the probability of winning for 100 bets on green. What could account for this difference?

**Answer: The CLT works better when the sample size is larger.**

## Section 3.3 Assessment: Random Variables, Sampling Models, and the Central Limit Theorem

### Questions 1 and 2: SAT testing
The SAT is a standardized college admissions test used in the United States. The following two multi-part questions will ask you some questions about SAT testing.

Report 3 significant digits:

```{r}
options(digits = 3)
```

This is a 6-part question asking you to determine some probabilities of what happens when a student guessed for all of their answers on the SAT. Use the information below to inform your answers for the following questions.

An old version of the SAT college entrance exam had a -0.25 point penalty for every incorrect answer and awarded 1 point for a correct answer. The quantitative test consisted of 44 multiple-choice questions each with 5 answer choices. Suppose a student chooses answers by guessing for all questions on the test.

#### Question 1a
What is the probability of guessing correctly for one question?
```{r}
p <- 1/5 # one correct choice of 5 options
p
```
#### Question 1b
What is the expected value of points for guessing on one question?
```{r}
a <- 1
b <- -0.25
mu <- a*p + b*(1-p)
mu
```
#### Question 1c
What is the expected score of guessing on all 44 questions?
```{r}
n <- 44
n*mu
```
#### Question 1d
What is the standard error of guessing on all 44 questions?
```{r}
sigma <- sqrt(n) * abs(b-a) * sqrt(p*(1-p))
sigma
```
#### Question 1e
Use the Central Limit Theorem to determine the probability that a guessing student scores 8 points or higher on the test.
```{r}
1-pnorm(8, mu, sigma)
```
#### Question 1f
Set the seed to 21, then run a Monte Carlo simulation of 10,000 students guessing on the test.

What is the probability that a guessing student scores 8 points or higher?

```{r}
set.seed(21, sample.kind = "Rounding")
B <- 10000
n <- 44
p <- 0.2
tests <- replicate(B, {
  X <- sample(c(1, -0.25), n, replace = TRUE, prob = c(p, 1-p))
  sum(X)
})
mean(tests >= 8)
```
The SAT was recently changed to reduce the number of multiple choice options from 5 to 4 and also to eliminate the penalty for guessing.

In this three-part question, you'll explore how that affected the expected values for the test.

#### Question 2a
Suppose that the number of multiple choice options is 4 and that there is no penalty for guessing - that is, an incorrect question gives a score of 0.

What is the expected value of the score when guessing on this new test?
```{r}
p <- 1/4
a <- 1
b <- 0
n <- 44
mu <- n * a*p + b*(1-p)
mu
```
#### Question 2b
What is the probability of scoring over 30 when guessing?
```{r}
sigma <- sqrt(n) * abs(b-a) * sqrt(p*(1-p))
1-pnorm(30, mu, sigma)
```
#### Question 2c
Consider a range of correct answer probabilities #p <- seq(0.25, 0.95, 0.05)# representing a range of student skills.

What is the lowest #p# such that the probability of scoring over 35 exceeds 80%?
```{r}
p <- seq(0.25, 0.95, 0.05)
exp_val <- sapply(p, function(x){
  mu <- n * a*x + b*(1-x)
  sigma <- sqrt(n) * abs(b-a) * sqrt(x*(1-x))
  1-pnorm(35, mu, sigma)
})

min(p[which(exp_val > 0.8)])
```
### Question 3: Betting on Roulette
A casino offers a House Special bet on roulette, which is a bet on five pockets (00, 0, 1, 2, 3) out of 38 total pockets. The bet pays out 6 to 1. In other words, a losing bet yields -$1 and a successful bet yields $6. A gambler wants to know the chance of losing money if he places 500 bets on the roulette House Special.

The following 7-part question asks you to do some calculations related to this scenario.

#### Question 3a
What is the expected value of the payout for one bet?
```{r}
p <- 5/38
a <- 6
b <- -1
mu <- a*p + b*(1-p)
mu
```
#### Question 3b
What is the standard error of the payout for one bet?
```{r}
sigma <- abs(b-a) * sqrt(p*(1-p))
sigma
```
#### Question 3c
What is the expected value of the average payout over 500 bets?
Remember there is a difference between expected value of the average and expected value of the sum.

```{r}
mu
```
#### Question 3d
What is the standard error of the average payout over 500 bets?
Remember there is a difference between the standard error of the average and standard error of the sum.

```{r}
n <- 500
sigma/sqrt(n)
```
#### Question 3e
What is the expected value of the sum of 500 bets?
```{r}
n*mu
```
#### Question 3f
What is the standard error of the sum of 500 bets?
```{r}
sqrt(n) * sigma
```
#### Question 3g
Use $pnorm$ with the expected value of the sum and standard error of the sum to calculate the probability of losing money over 500 bets,  $Pr(Xâ‰¤0)$.
```{r}
pnorm(0, n*mu, sqrt(n)*sigma)
```
# Section 4
## Section 4.1 The Big Short 
### Exercise 1. Bank earnings
Say you manage a bank that gives out 10,000 loans. The default rate is 0.03 and you lose $200,000 in each foreclosure.

Create a random variable $S$ that contains the earnings of your bank. Calculate the total amount of money lost in this scenario.

- Using the $sample$ function, generate a vector called $defaults$ that contains $n$ samples from a vector of $c(0,1)$, where $0$ indicates a payment and $1$ indicates a default
- Multiply the total number of defaults by the loss per foreclosure.
```{r}
# Assign the number of loans to the variable `n`
n <- 10000

# Assign the loss per foreclosure to the variable `loss_per_foreclosure`
loss_per_foreclosure <- -200000

# Assign the probability of default to the variable `p_default`
p_default <- 0.03

# Use the `set.seed` function to make sure your answer matches the expected result after random sampling
set.seed(1, sample.kind = "Rounding")

# Generate a vector called `defaults` that contains the default outcomes of `n` loans
defaults <- loss_per_foreclosure * sample(c(0,1),n,replace=TRUE,prob=c(1-p_default,p_default))

# Generate `S`, the total amount of money lost across all foreclosures. Print the value to the console.
(S <- sum(defaults))
```
### Exercise 2. Bank earnings Monte Carlo
Run a Monte Carlo simulation with 10,000 outcomes for $S$, the sum of losses over 10,000 loans. Make a histogram of the results.

- Within a $replicate$ loop with 10,000 iterations, use $sample$ to generate a list of 10,000 loan outcomes: payment (0) or default (1). Use the outcome order $c(0,1)$ and probability of default $p\_default$.
- Still within the loop, use the function $sum$ to count the number of foreclosures multiplied by $loss\_per\_foreclosure$ to return the sum of all losses across the 10,000 loans. *If you do not take the sum inside the $replicate$ loop, DataCamp may crash with a "Session Expired" error.*
- Plot the histogram of values using the function hist.
```{r}
# Assign the number of loans to the variable `n`
n <- 10000

# Assign the loss per foreclosure to the variable `loss_per_foreclosure`
loss_per_foreclosure <- -200000

# Assign the probability of default to the variable `p_default`
p_default <- 0.03

# Use the `set.seed` function to make sure your answer matches the expected result after random sampling
set.seed(1, sample.kind = "Rounding")

# The variable `B` specifies the number of times we want the simulation to run
B <- 10000

# Generate a list of summed losses 'S'. Replicate the code from the previous exercise over 'B' iterations to generate a list of summed losses for 'n' loans.  Ignore any warnings for now.
S <- replicate(B,{
  res<-sample(c(0,1),n,replace=TRUE,prob=c(1-p_default,p_default))
  sum(res*loss_per_foreclosure)
  })

# Plot a histogram of 'S'.  Ignore any warnings for now.
hist(S)
```
### Exercise 3. Bank earnings expected value
What is the expected value of $S$, the sum of losses over 10,000 loans? For now, assume a bank makes no money if the loan is paid.

- Using the chances of default ($p\_default$), calculate the expected losses over 10,000 loans.
```{r}
# Assign the number of loans to the variable `n`
n <- 10000

# Assign the loss per foreclosure to the variable `loss_per_foreclosure`
loss_per_foreclosure <- -200000

# Assign the probability of default to the variable `p_default`
p_default <- 0.03

# Calculate the expected loss due to default out of 10,000 loans
n*loss_per_foreclosure*p_default
```
### Exercise 4. Bank earnings standard error
What is the standard error of $S$?

- Compute the standard error of the random variable $S$ you generated in the previous exercise, the summed outcomes of 10,000 loans.

```{r}
# Assign the number of loans to the variable `n`
n <- 10000

# Assign the loss per foreclosure to the variable `loss_per_foreclosure`
loss_per_foreclosure <- -200000

# Assign the probability of default to the variable `p_default`
p_default <- 0.03

# Compute the standard error of the sum of 10,000 loans
sqrt(n)*abs(loss_per_foreclosure)*sqrt((1- p_default)* p_default)
```
### Exercise 5. Bank earnings interest rate - 1
So far, we've been assuming that we make no money when people pay their loans and we lose a lot of money when people default on their loans. Assume we give out loans for $180,000. How much money do we need to make when people pay their loans so that our net loss is $0?

In other words, what interest rate do we need to charge in order to not lose money?

- If the amount of money lost or gained equals 0, the probability of default times the total loss per default equals the amount earned per probability of the loan being paid.
- Divide the total amount needed per loan by the loan amount to determine the interest rate.
```{r}
# Assign the loss per foreclosure to the variable `loss_per_foreclosure`
loss_per_foreclosure <- -200000

# Assign the probability of default to the variable `p_default`
p_default <- 0.03

# Assign a variable `x` as the total amount necessary to have an expected outcome of $0
x <- p_default * loss_per_foreclosure / -(1- p_default)

# Convert `x` to a rate, given that the loan amount is $180,000. Print this value to the console.
x/180000
```
### Exercise 6. Bank earnings interest rate - 2
With the interest rate calculated in the last example, we still lose money 50% of the time. What should the interest rate be so that the chance of losing money is 1 in 20?

In math notation, what should the interest rate be so that $Pr(S<0)=0.05$?

Remember that we can add a constant to both sides of the equation to get:
\[Pr\left ( \frac{S-E[S]}{SE[S]}<\frac{-E[S]}{SE[S]} \right )\]

which is

\[Pr\left (Z<\frac{-[lp+x(1-p)]n}{(x-l)\sqrt{np(1-p)}} \right )=.05\]

Let $z = qnorm(0.05)$ give us the value of $z$ for which:
$Pr(Zâ‰¤z)=0.05$

-Use the $qnorm$ function to compute a continuous variable at given quantile of the distribution to solve for $z$.
- In this equation, $l$, $p$, and $n$ are known values. Once you've solved for $z$, solve for $x$.
- Divide $x$ by the loan amount to calculate the rate.
```{r}
# Assign the number of loans to the variable `n`
n <- 10000

# Assign the loss per foreclosure to the variable `loss_per_foreclosure`
loss_per_foreclosure <- -200000

# Assign the probability of default to the variable `p_default`
p_default <- 0.03

# Generate a variable `z` using the `qnorm` function
z <- qnorm(0.05)

# Generate a variable `x` using `z`, `p_default`, `loss_per_foreclosure`, and `n`
x <- -loss_per_foreclosure*(n * p_default - z * sqrt(n * p_default*(1- p_default)))/ (n* ( 1- p_default) + z * sqrt(n * p_default * ( 1 - p_default)))

# Convert `x` to an interest rate, given that the loan amount is $180,000. Print this value to the console.
x/180000
```
### Exercise 7. Bank earnings - minimize money loss
The bank wants to minimize the probability of losing money. Which of the following achieves their goal without making interest rates go up?

**Answer: A reduced default rate**

# Reference {-}

Rafael Irizarry (2019) - *Data Science: Probability*, Harvard University 
https://www.edx.org/course/data-science-probability